version: '3.8'

services:
  stock-gita-agent:
    build: .
    ports:
      - "7777:8000"
    environment:
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_DEFAULT_REGION=us-east-1
      - API_SOURCE=${API_SOURCE:-yahoo}  # yahoo or twelve
    volumes:
      - ./stock_gita_engine_charts:/app/stock_gita_engine_charts # For live reloading if needed
      - ./credentials.json:/app/credentials.json  # Mount credentials.json for Twelve Data API keys

  open-webui:
    image: ghcr.io/open-webui/open-webui:main
    ports:
      - "7778:8080"
    environment:
      - OPENAI_API_BASE_URL=http://stock-gita-agent:8000/v1
      - OPENAI_API_KEY=sk-1234
      - WEBUI_AUTH=true
      - ENABLE_SIGNUP=true
      - DEFAULT_USER_ROLE=user
    volumes:
      - open-webui-data:/app/backend/data
    restart: always

volumes:
  open-webui-data:
